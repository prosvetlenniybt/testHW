<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Монстрик</title>
  <meta name="viewport"
        content="width=375, initial-scale=1, maximum-scale=1, viewport-fit=cover" />

  <!-- three.js через import map -->
  <script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
      "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
    }
  }
  </script>

  <style>
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Helvetica Neue", Arial, sans-serif;
      background: #f5f5f7;
      color: #111;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .phone {
      position: relative;
      width: 375px;
      height: 812px;
      background: #f5f5f7;
      overflow: hidden;
    }

    /* Верхняя панель */
    .top-bar {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 144px;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 16px 20px 0;
    }

    .back-button {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: #111;
      font-size: 16px;
      cursor: pointer;
      background: none;
      border: none;
    }

    .back-arrow { font-size: 18px; transform: translateY(-1px); }

    .icon-button {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      border: 1.5px solid #111;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.8);
      cursor: pointer;
    }

    .hanger-icon {
      width: 16px;
      height: 10px;
      border-bottom: 1.5px solid #111;
      border-radius: 0 0 50% 50%;
      position: relative;
    }

    .hanger-icon::before {
      content: "";
      position: absolute;
      left: 50%;
      top: -4px;
      width: 6px;
      height: 6px;
      border: 1.5px solid #111;
      border-radius: 50%;
      transform: translateX(-50%);
      border-bottom-color: transparent;
      border-left-color: transparent;
    }

    /* Шкаф: 375×518 */
    .wardrobe-wrapper {
      position: absolute;
      left: 0;
      top: 144px;
      width: 375px;
      height: 518px;
    }

    /* Вместо wardrobe.png — фигура */
    .wardrobe-figure {
      position: absolute;
      inset: 0;
      /* тело шкафа */
      background:
        /* боковые стойки */
        linear-gradient(90deg, rgba(0,0,0,0.12), rgba(0,0,0,0) 20%) left/26px 100% no-repeat,
        linear-gradient(270deg, rgba(0,0,0,0.12), rgba(0,0,0,0) 20%) right/26px 100% no-repeat,
        /* верхняя перемычка */
        linear-gradient(180deg, rgba(0,0,0,0.10), rgba(0,0,0,0)) top/100% 32px no-repeat,
        /* основа */
        linear-gradient(180deg, #e7d9c8, #d9c6b1);
      border-radius: 14px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.10);
      overflow: hidden;
    }

    /* внутренние "двери" / панели */
    .wardrobe-figure::before {
      content: "";
      position: absolute;
      inset: 18px 18px 26px 18px;
      border-radius: 12px;
      background:
        /* центральная линия между дверями */
        linear-gradient(90deg, rgba(0,0,0,0.10), rgba(0,0,0,0.10)) 50% 0/2px 100% no-repeat,
        /* левая дверь */
        linear-gradient(180deg, rgba(255,255,255,0.35), rgba(0,0,0,0.06)),
        /* правая дверь */
        linear-gradient(180deg, rgba(255,255,255,0.28), rgba(0,0,0,0.08));
      box-shadow: inset 0 0 0 2px rgba(0,0,0,0.10);
    }

    /* полки + ручки */
    .wardrobe-inner {
      position: absolute;
      inset: 18px 18px 26px 18px;
      pointer-events: none;
    }

    .shelf {
      position: absolute;
      left: 10px;
      right: 10px;
      height: 2px;
      background: rgba(0,0,0,0.10);
      border-radius: 2px;
    }
    .shelf.s1 { top: 120px; }
    .shelf.s2 { top: 250px; }
    .shelf.s3 { top: 380px; }

    .handle {
      position: absolute;
      top: 190px;
      width: 8px;
      height: 34px;
      border-radius: 999px;
      background: rgba(0,0,0,0.22);
      box-shadow: inset 0 0 0 2px rgba(255,255,255,0.25);
    }
    .handle.h1 { left: calc(50% - 18px); }
    .handle.h2 { left: calc(50% + 10px); }

    /* Три белые кнопки слева */
    .side-button {
      position: absolute;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: #ffffff;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.18);
      border: none;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      cursor: pointer;
      z-index: 15;
    }

    .side-button-1 { left: 36px; top: 35px; }
    .side-button-2 { left: 36px; top: 210px; }
    .side-button-3 { left: 36px; top: 380px; }

    .side-button:hover { transform: scale(1.1); box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25); }
    .side-button:active { transform: scale(0.95); box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); }

    /* Контейнер монстра */
    .monster-container {
      position: absolute;
      left: 100px;
      top: 340px;
      bottom: 100px;
      width: 270px;
      height: 390px;
      pointer-events: none;
      z-index: 20;
      overflow: visible;
    }

    /* ВАЖНО: canvas занимает весь контейнер */
    .monster-container canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    /* Нижняя панель */
    .bottom-panel {
      position: absolute;
      left: 0;
      bottom: 24px;
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 16px;
    }

    .coin-button {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 22px;
      border-radius: 999px;
      background: #f7d9b8;
      font-size: 16px;
      box-shadow: 0 4px 9px rgba(0, 0, 0, 0.15);
      cursor: pointer;
      border: none;
    }

    .coin-icon {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 1.5px solid #111;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
    }

    .round-button {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #f7d9b8;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      box-shadow: 0 4px 9px rgba(0, 0, 0, 0.15);
      cursor: pointer;
      border: none;
    }

    /* Модалка */
    .modal {
      position: absolute;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 200;
    }
    .modal.visible { display: flex; }

    .modal-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.25);
    }

    .modal-window {
      position: relative;
      max-width: 300px;
      width: 80%;
      background: #ffffff;
      border-radius: 18px;
      padding: 20px 20px 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
      text-align: center;
      z-index: 1;
    }

    .modal-text { margin: 0 0 16px; font-size: 14px; line-height: 1.4; }

    .modal-close-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 8px 18px;
      border-radius: 999px;
      background: #ff4b4b;
      color: #fff;
      font-size: 14px;
      cursor: pointer;
      border: none;
    }
    .modal-close-button:active {
      transform: translateY(1px);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25) inset;
    }
  </style>
</head>
<body>
  <div class="phone">
    <!-- Верх -->
    <header class="top-bar">
      <button class="back-button" id="backButton">
        <span class="back-arrow">←</span>
        <span>Назад</span>
      </button>

      <button class="icon-button" id="hangerButton" aria-label="Гардероб">
        <span class="hanger-icon"></span>
      </button>
    </header>

    <!-- Шкаф (фигура вместо картинки) -->
    <div class="wardrobe-wrapper">
      <div class="wardrobe-figure" aria-label="Шкаф (фигура)"></div>
      <div class="wardrobe-inner" aria-hidden="true">
        <div class="shelf s1"></div>
        <div class="shelf s2"></div>
        <div class="shelf s3"></div>
        <div class="handle h1"></div>
        <div class="handle h2"></div>
      </div>

      <button class="side-button side-button-1" id="sideButton1"></button>
      <button class="side-button side-button-2" id="sideButton2"></button>
      <button class="side-button side-button-3" id="sideButton3"></button>
    </div>

    <!-- Контейнер монстра -->
    <div class="monster-container" id="monsterContainer"></div>

    <!-- Нижняя плашка -->
    <div class="bottom-panel">
      <button class="coin-button" id="coinButton">
        <span class="coin-text">30</span>
        <span class="coin-icon">◎</span>
      </button>
      <button class="round-button" id="plusButton">+</button>
    </div>

    <!-- Модалка -->
    <div class="modal" id="lockedModal">
      <div class="modal-backdrop"></div>
      <div class="modal-window">
        <p class="modal-text">
          откроется на 5 уровне! ждем тебя, совсем скоро!
        </p>
        <button class="modal-close-button" id="modalCloseButton">понятно</button>
      </div>
    </div>
  </div>

  <script type="module">
    import * as THREE from "three";
    import { GLTFLoader } from "three/addons/loaders/GLTFLoader.js";
    import { DRACOLoader } from "three/addons/loaders/DRACOLoader.js";

    const backButton = document.getElementById("backButton");
    const hangerButton = document.getElementById("hangerButton");
    const sideButton1 = document.getElementById("sideButton1");
    const sideButton2 = document.getElementById("sideButton2");
    const sideButton3 = document.getElementById("sideButton3");
    const coinButton = document.getElementById("coinButton");
    const plusButton = document.getElementById("plusButton");
    const monsterContainer = document.getElementById("monsterContainer");

    const modal = document.getElementById("lockedModal");
    const modalBackdrop = modal.querySelector(".modal-backdrop");
    const modalCloseButton = document.getElementById("modalCloseButton");

    backButton.addEventListener("click", () => {
      window.location.href =
        "https://mmarmar4028-gif.github.io/kids-site/game_screen.html";
    });

    hangerButton.addEventListener("click", () => {
      modal.classList.add("visible");
    });

    sideButton2.addEventListener("click", () => {
      console.log("Вторая боковая кнопка нажата");
      modal.classList.add("visible");
    });

    sideButton1.addEventListener("click", () => console.log("Первая боковая кнопка нажата"));
    sideButton3.addEventListener("click", () => console.log("Третья боковая кнопка нажата"));

    const closeModal = () => modal.classList.remove("visible");
    modalCloseButton.addEventListener("click", closeModal);
    modalBackdrop.addEventListener("click", closeModal);

    coinButton.addEventListener("click", () => console.log("Кнопка монет нажата"));
    plusButton.addEventListener("click", () => console.log("Кнопка '+' нажата"));

    const scene = new THREE.Scene();

    const camera = new THREE.PerspectiveCamera(35, 1, 0.1, 100);
    camera.position.set(0, 0.4, 2.8);

    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setPixelRatio(window.devicePixelRatio || 1);
    renderer.outputColorSpace = THREE.SRGBColorSpace;
    monsterContainer.appendChild(renderer.domElement);

    function resizeRenderer() {
      const width = monsterContainer.clientWidth || 270;
      const height = monsterContainer.clientHeight || 390;
      renderer.setSize(width, height, false);
      camera.aspect = width / height;
      camera.updateProjectionMatrix();
    }

    resizeRenderer();
    window.addEventListener("resize", resizeRenderer);

    const hemiLight = new THREE.HemisphereLight(0xffffff, 0xffcccc, 1.2);
    hemiLight.position.set(0, 1, 0);
    scene.add(hemiLight);

    const dirLight = new THREE.DirectionalLight(0xffffff, 0.9);
    dirLight.position.set(1, 1.2, 1.5);
    scene.add(dirLight);

    const dracoLoader = new DRACOLoader();
    dracoLoader.setDecoderPath(
      "https://www.gstatic.com/draco/versioned/decoders/1.5.6/"
    );
    dracoLoader.setDecoderConfig({ type: "js" });
    dracoLoader.preload();

    const gltfLoader = new GLTFLoader();
    gltfLoader.setDRACOLoader(dracoLoader);

    let monster = null;

    gltfLoader.load(
      "monster.glb",
      (gltf) => {
        monster = gltf.scene;

        const box = new THREE.Box3().setFromObject(monster);
        const size = new THREE.Vector3();
        box.getSize(size);
        const center = new THREE.Vector3();
        box.getCenter(center);

        monster.position.sub(center);
        gltfLoader.load(
  "monster.glb",
  (gltf) => {
    monster = gltf.scene;

    // 1. Bounding box модели
    const box = new THREE.Box3().setFromObject(monster);
    const size = box.getSize(new THREE.Vector3());
    const center = box.getCenter(new THREE.Vector3());

    // 2. Центрируем модель
    monster.position.sub(center);

    // 3. Подгоняем камеру под размер модели
    const maxDim = Math.max(size.x, size.y, size.z);
    const fov = camera.fov * (Math.PI / 180);
    const cameraZ = maxDim / (2 * Math.tan(fov / 2));

    camera.position.set(0, 0.2, cameraZ * 1.4);
    camera.lookAt(0, 0, 0);
    camera.updateProjectionMatrix();

    scene.add(monster);
    console.log("Модель подогнана и добавлена в сцену");
  },
  undefined,
  (error) => console.error(error)
);


       
        monster.traverse((child) => {
          if (child.isMesh) {
            child.castShadow = false;
            child.receiveShadow = false;
          }
        });

        scene.add(monster);
        console.log("Модель монстрика успешно загружена");
      },
      undefined,
      (error) => console.error("Ошибка при загрузке модели монстрика:", error)
    );

    function animate() {
      requestAnimationFrame(animate);
      if (monster) monster.rotation.y += 0.01;
      renderer.render(scene, camera);
    }
    animate();
  </script>
</body>
</html>
